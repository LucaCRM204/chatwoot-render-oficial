{"version":3,"file":"Thumbnail-DwWGrtq5.js","sources":["../../../app/javascript/dashboard/components/widgets/Avatar.vue","../../../app/javascript/shared/helpers/emoji.js","../../../app/javascript/dashboard/components/widgets/Thumbnail.vue"],"sourcesContent":["<script>\r\nexport default {\r\n  name: 'Avatar',\r\n  props: {\r\n    username: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n    size: {\r\n      type: Number,\r\n      default: 40,\r\n    },\r\n  },\r\n  computed: {\r\n    style() {\r\n      return {\r\n        fontSize: `${Math.floor(this.size / 2.5)}px`,\r\n      };\r\n    },\r\n    userInitial() {\r\n      const parts = this.username.split(/[ -]/);\r\n      let initials = parts.reduce((acc, curr) => acc + curr.charAt(0), '');\r\n\r\n      if (initials.length > 2 && initials.search(/[A-Z]/) !== -1) {\r\n        initials = initials.replace(/[a-z]+/g, '');\r\n      }\r\n      initials = initials.substring(0, 2).toUpperCase();\r\n\r\n      return initials;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div class=\"avatar-container\" :style=\"style\" aria-hidden=\"true\">\r\n    <slot>{{ userInitial }}</slot>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n@tailwind components;\r\n@layer components {\r\n  .avatar-color {\r\n    background-image: linear-gradient(to top, #c2e1ff 0%, #d6ebff 100%);\r\n  }\r\n\r\n  .dark-avatar-color {\r\n    background-image: linear-gradient(to top, #135899 0%, #135899 100%);\r\n  }\r\n}\r\n.avatar-container {\r\n  @apply flex leading-[100%] font-medium items-center justify-center text-center cursor-default avatar-color dark:dark-avatar-color text-woot-600 dark:text-woot-200;\r\n}\r\n</style>\r\n","/**\r\n * Detects support for emoji character sets.\r\n *\r\n * Based on the Modernizr emoji detection.\r\n * https://github.com/Modernizr/Modernizr/blob/347ddb078116cee91b25b6e897e211b023f9dcb4/feature-detects/emoji.js\r\n *\r\n * @return {Boolean} true or false\r\n * @example\r\n *\r\n * hasEmojiSupport()\r\n * // => true|false\r\n */\r\nexport const hasEmojiSupport = () => {\r\n  const pixelRatio = window.devicePixelRatio || 1;\r\n  const offset = 12 * pixelRatio;\r\n  const node = document.createElement('canvas');\r\n\r\n  // canvastext support\r\n  if (\r\n    !node.getContext ||\r\n    !node.getContext('2d') ||\r\n    typeof node.getContext('2d').fillText !== 'function'\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  const ctx = node.getContext('2d');\r\n\r\n  ctx.fillStyle = '#f00';\r\n  ctx.textBaseline = 'top';\r\n  ctx.font = '32px Arial';\r\n  ctx.fillText('\\ud83d\\udc28', 0, 0); // U+1F428 KOALA\r\n  return ctx.getImageData(offset, offset, 1, 1).data[0] !== 0;\r\n};\r\n\r\nexport const removeEmoji = text => {\r\n  if (text) {\r\n    return text\r\n      .replace(\r\n        /([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|[\\u2011-\\u26FF]|\\uD83E[\\uDD10-\\uDDFF])/g,\r\n        ''\r\n      )\r\n      .replace(/\\s+/g, ' ')\r\n      .trim();\r\n  }\r\n  return '';\r\n};\r\n","<script>\r\n/**\r\n * Thumbnail Component\r\n * Src - source for round image\r\n * Size - Size of the thumbnail\r\n * Badge - Chat source indication { fb / telegram }\r\n * Username - Username for avatar\r\n */\r\nimport Avatar from './Avatar.vue';\r\nimport { removeEmoji } from 'shared/helpers/emoji';\r\n\r\nexport default {\r\n  components: {\r\n    Avatar,\r\n  },\r\n  props: {\r\n    src: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n    size: {\r\n      type: String,\r\n      default: '40px',\r\n    },\r\n    badge: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n    username: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n    status: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n    hasBorder: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    shouldShowStatusAlways: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n    variant: {\r\n      type: String,\r\n      default: 'circle',\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      hasImageLoaded: false,\r\n      imgError: false,\r\n    };\r\n  },\r\n  computed: {\r\n    userNameWithoutEmoji() {\r\n      return removeEmoji(this.username);\r\n    },\r\n    showStatusIndicator() {\r\n      if (this.shouldShowStatusAlways) return true;\r\n      return this.status === 'online' || this.status === 'busy';\r\n    },\r\n    avatarSize() {\r\n      return Number(this.size.replace(/\\D+/g, ''));\r\n    },\r\n    badgeSrc() {\r\n      return {\r\n        instagram_direct_message: 'instagram-dm',\r\n        facebook: 'messenger',\r\n        'twitter-tweet': 'twitter-tweet',\r\n        'twitter-dm': 'twitter-dm',\r\n        whatsapp: 'whatsapp',\r\n        sms: 'sms',\r\n        'Channel::Line': 'line',\r\n        'Channel::Telegram': 'telegram',\r\n        'Channel::WebWidget': '',\r\n      }[this.badge];\r\n    },\r\n    badgeStyle() {\r\n      const size = Math.floor(this.avatarSize / 3);\r\n      const badgeSize = `${size + 2}px`;\r\n      const borderRadius = `${size / 2}px`;\r\n      return { width: badgeSize, height: badgeSize, borderRadius };\r\n    },\r\n    statusStyle() {\r\n      const statusSize = `${this.avatarSize / 4}px`;\r\n      return { width: statusSize, height: statusSize };\r\n    },\r\n    thumbnailClass() {\r\n      const className = this.hasBorder\r\n        ? 'border border-solid border-white dark:border-slate-700/50'\r\n        : '';\r\n      const variant =\r\n        this.variant === 'circle' ? 'thumbnail-rounded' : 'thumbnail-square';\r\n      return `user-thumbnail ${className} ${variant}`;\r\n    },\r\n    thumbnailBoxClass() {\r\n      const boxClass = this.variant === 'circle' ? 'is-rounded' : '';\r\n      return `user-thumbnail-box ${boxClass}`;\r\n    },\r\n    shouldShowImage() {\r\n      if (!this.src) {\r\n        return false;\r\n      }\r\n      if (this.hasImageLoaded) {\r\n        return !this.imgError;\r\n      }\r\n      return false;\r\n    },\r\n  },\r\n  watch: {\r\n    src(value, oldValue) {\r\n      if (value !== oldValue && this.imgError) {\r\n        this.imgError = false;\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    onImgError() {\r\n      this.imgError = true;\r\n    },\r\n    onImgLoad() {\r\n      this.hasImageLoaded = true;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    :class=\"thumbnailBoxClass\"\r\n    :style=\"{ height: size, width: size }\"\r\n    :title=\"title\"\r\n  >\r\n    <!-- Using v-show instead of v-if to avoid flickering as v-if removes dom elements.  -->\r\n    <slot>\r\n      <img\r\n        v-show=\"shouldShowImage\"\r\n        :src=\"src\"\r\n        draggable=\"false\"\r\n        :class=\"thumbnailClass\"\r\n        @load=\"onImgLoad\"\r\n        @error=\"onImgError\"\r\n      />\r\n      <Avatar\r\n        v-show=\"!shouldShowImage\"\r\n        :username=\"userNameWithoutEmoji\"\r\n        :class=\"thumbnailClass\"\r\n        :size=\"avatarSize\"\r\n      />\r\n    </slot>\r\n    <img\r\n      v-if=\"badgeSrc\"\r\n      class=\"source-badge z-20\"\r\n      :style=\"badgeStyle\"\r\n      :src=\"`/integrations/channels/badges/${badgeSrc}.png`\"\r\n      alt=\"Badge\"\r\n    />\r\n    <div\r\n      v-if=\"showStatusIndicator\"\r\n      class=\"z-20\"\r\n      :class=\"`source-badge user-online-status user-online-status--${status}`\"\r\n      :style=\"statusStyle\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n.user-thumbnail-box {\r\n  flex: 0 0 auto;\r\n  max-width: 100%;\r\n  position: relative;\r\n\r\n  &.is-rounded {\r\n    border-radius: 50%;\r\n  }\r\n\r\n  .user-thumbnail {\r\n    border-radius: 50%;\r\n    &.thumbnail-square {\r\n      border-radius: var(--border-radius-large);\r\n    }\r\n    height: 100%;\r\n    width: 100%;\r\n    box-sizing: border-box;\r\n    object-fit: cover;\r\n    vertical-align: initial;\r\n  }\r\n\r\n  .source-badge {\r\n    border-radius: var(--border-radius-small);\r\n    bottom: var(--space-minus-micro);\r\n    box-shadow: var(--shadow-small);\r\n    height: var(--space-slab);\r\n    padding: var(--space-micro);\r\n    position: absolute;\r\n    right: 0;\r\n    width: var(--space-slab);\r\n    @apply bg-white dark:bg-slate-900;\r\n  }\r\n\r\n  .user-online-status {\r\n    border-radius: 50%;\r\n    bottom: var(--space-micro);\r\n\r\n    &:after {\r\n      content: ' ';\r\n    }\r\n  }\r\n\r\n  .user-online-status--online {\r\n    @apply bg-green-400 dark:bg-green-400;\r\n  }\r\n\r\n  .user-online-status--busy {\r\n    @apply bg-yellow-500 dark:bg-yellow-500;\r\n  }\r\n\r\n  .user-online-status--offline {\r\n    @apply bg-slate-500 dark:bg-slate-500;\r\n  }\r\n}\r\n</style>\r\n"],"names":["_sfc_main","initials","acc","curr","_createElementBlock","_normalizeStyle","$options","_renderSlot","_ctx","_createTextVNode","_toDisplayString","hasEmojiSupport","offset","node","ctx","removeEmoji","text","Avatar","size","badgeSize","borderRadius","statusSize","className","variant","value","oldValue","_hoisted_1","_hoisted_2","_hoisted_3","_normalizeClass","$props","_createElementVNode","args","_createVNode","_component_Avatar","_createCommentVNode"],"mappings":"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"}