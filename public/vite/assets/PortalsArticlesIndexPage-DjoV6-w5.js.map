{"version":3,"file":"PortalsArticlesIndexPage-DjoV6-w5.js","sources":["../../../app/javascript/dashboard/components-next/HelpCenter/Pages/ArticlePage/ArticleList.vue","../../../app/javascript/dashboard/components-next/HelpCenter/Pages/ArticlePage/ArticleHeaderControls.vue","../../../app/javascript/dashboard/components-next/HelpCenter/EmptyState/Article/ArticleEmptyState.vue","../../../app/javascript/dashboard/components-next/HelpCenter/Pages/ArticlePage/ArticlesPage.vue","../../../app/javascript/dashboard/routes/dashboard/helpcenter/pages/PortalsArticlesIndexPage.vue"],"sourcesContent":["<script setup>\r\nimport { ref, computed, watch } from 'vue';\r\nimport Draggable from 'vuedraggable';\r\nimport { useMapGetter, useStore } from 'dashboard/composables/store.js';\r\nimport { useRouter, useRoute } from 'vue-router';\r\nimport { useI18n } from 'vue-i18n';\r\nimport { useAlert, useTrack } from 'dashboard/composables';\r\nimport { PORTALS_EVENTS } from 'dashboard/helper/AnalyticsHelper/events';\r\nimport { getArticleStatus } from 'dashboard/helper/portalHelper.js';\r\nimport wootConstants from 'dashboard/constants/globals';\r\n\r\nimport ArticleCard from 'dashboard/components-next/HelpCenter/ArticleCard/ArticleCard.vue';\r\n\r\nconst props = defineProps({\r\n  articles: {\r\n    type: Array,\r\n    required: true,\r\n  },\r\n  isCategoryArticles: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n});\r\n\r\nconst { ARTICLE_STATUS_TYPES } = wootConstants;\r\n\r\nconst router = useRouter();\r\nconst route = useRoute();\r\nconst store = useStore();\r\nconst { t } = useI18n();\r\n\r\nconst localArticles = ref(props.articles);\r\n\r\nconst dragEnabled = computed(() => {\r\n  // Enable dragging only for category articles and when there's more than one article\r\n  return props.isCategoryArticles && localArticles.value?.length > 1;\r\n});\r\n\r\nconst getCategoryById = useMapGetter('categories/categoryById');\r\n\r\nconst openArticle = id => {\r\n  const { tab, categorySlug, locale } = route.params;\r\n  if (props.isCategoryArticles) {\r\n    router.push({\r\n      name: 'portals_categories_articles_edit',\r\n      params: { articleSlug: id },\r\n    });\r\n  } else {\r\n    router.push({\r\n      name: 'portals_articles_edit',\r\n      params: {\r\n        articleSlug: id,\r\n        tab,\r\n        categorySlug,\r\n        locale,\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nconst onReorder = reorderedGroup => {\r\n  store.dispatch('articles/reorder', {\r\n    reorderedGroup,\r\n    portalSlug: route.params.portalSlug,\r\n  });\r\n};\r\n\r\nconst onDragEnd = () => {\r\n  // Reuse existing positions to maintain order within the current group\r\n  const sortedArticlePositions = localArticles.value\r\n    .map(article => article.position)\r\n    .sort((a, b) => a - b); // Use custom sort to handle numeric values correctly\r\n\r\n  const orderedArticles = localArticles.value.map(article => article.id);\r\n\r\n  // Create a map of article IDs to their new positions\r\n  const reorderedGroup = orderedArticles.reduce((obj, key, index) => {\r\n    obj[key] = sortedArticlePositions[index];\r\n    return obj;\r\n  }, {});\r\n\r\n  onReorder(reorderedGroup);\r\n};\r\n\r\nconst getCategory = categoryId => {\r\n  return getCategoryById.value(categoryId) || { name: '', icon: '' };\r\n};\r\n\r\nconst getStatusMessage = (status, isSuccess) => {\r\n  const messageType = isSuccess ? 'SUCCESS' : 'ERROR';\r\n  const statusMap = {\r\n    [ARTICLE_STATUS_TYPES.PUBLISH]: 'PUBLISH_ARTICLE',\r\n    [ARTICLE_STATUS_TYPES.ARCHIVE]: 'ARCHIVE_ARTICLE',\r\n    [ARTICLE_STATUS_TYPES.DRAFT]: 'DRAFT_ARTICLE',\r\n  };\r\n\r\n  return statusMap[status]\r\n    ? t(`HELP_CENTER.${statusMap[status]}.API.${messageType}`)\r\n    : '';\r\n};\r\n\r\nconst updatePortalMeta = () => {\r\n  const { portalSlug, locale } = route.params;\r\n  return store.dispatch('portals/show', { portalSlug, locale });\r\n};\r\n\r\nconst updateArticlesMeta = () => {\r\n  const { portalSlug, locale } = route.params;\r\n  return store.dispatch('articles/updateArticleMeta', {\r\n    portalSlug,\r\n    locale,\r\n  });\r\n};\r\n\r\nconst handleArticleAction = async (action, { status, id }) => {\r\n  const { portalSlug } = route.params;\r\n  try {\r\n    if (action === 'delete') {\r\n      await store.dispatch('articles/delete', {\r\n        portalSlug,\r\n        articleId: id,\r\n      });\r\n      useAlert(t('HELP_CENTER.DELETE_ARTICLE.API.SUCCESS_MESSAGE'));\r\n    } else {\r\n      await store.dispatch('articles/update', {\r\n        portalSlug,\r\n        articleId: id,\r\n        status,\r\n      });\r\n      useAlert(getStatusMessage(status, true));\r\n\r\n      if (status === ARTICLE_STATUS_TYPES.ARCHIVE) {\r\n        useTrack(PORTALS_EVENTS.ARCHIVE_ARTICLE, { uiFrom: 'header' });\r\n      } else if (status === ARTICLE_STATUS_TYPES.PUBLISH) {\r\n        useTrack(PORTALS_EVENTS.PUBLISH_ARTICLE);\r\n      }\r\n    }\r\n    await updateArticlesMeta();\r\n    await updatePortalMeta();\r\n  } catch (error) {\r\n    const errorMessage =\r\n      error?.message ||\r\n      (action === 'delete'\r\n        ? t('HELP_CENTER.DELETE_ARTICLE.API.ERROR_MESSAGE')\r\n        : getStatusMessage(status, false));\r\n    useAlert(errorMessage);\r\n  }\r\n};\r\n\r\nconst updateArticle = ({ action, value, id }) => {\r\n  const status = action !== 'delete' ? getArticleStatus(value) : null;\r\n  handleArticleAction(action, { status, id });\r\n};\r\n\r\n// Watch for changes in the articles prop and update the localArticles ref\r\nwatch(\r\n  () => props.articles,\r\n  newArticles => {\r\n    localArticles.value = newArticles;\r\n  },\r\n  { deep: true }\r\n);\r\n</script>\r\n\r\n<template>\r\n  <Draggable\r\n    v-model=\"localArticles\"\r\n    :disabled=\"!dragEnabled\"\r\n    item-key=\"id\"\r\n    tag=\"ul\"\r\n    ghost-class=\"article-ghost-class\"\r\n    class=\"w-full h-full space-y-4\"\r\n    @end=\"onDragEnd\"\r\n  >\r\n    <template #item=\"{ element }\">\r\n      <li class=\"list-none rounded-2xl\">\r\n        <ArticleCard\r\n          :id=\"element.id\"\r\n          :key=\"element.id\"\r\n          :title=\"element.title\"\r\n          :status=\"element.status\"\r\n          :author=\"element.author\"\r\n          :category=\"getCategory(element.category.id)\"\r\n          :views=\"element.views || 0\"\r\n          :updated-at=\"element.updatedAt\"\r\n          :class=\"{ 'cursor-grab': dragEnabled }\"\r\n          @open-article=\"openArticle\"\r\n          @article-action=\"updateArticle\"\r\n        />\r\n      </li>\r\n    </template>\r\n  </Draggable>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n.article-ghost-class {\r\n  @apply opacity-50 bg-n-solid-1;\r\n}\r\n</style>\r\n","<script setup>\r\nimport { ref, computed } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\nimport { useRoute } from 'vue-router';\r\nimport { OnClickOutside } from '@vueuse/components';\r\nimport { useUISettings } from 'dashboard/composables/useUISettings';\r\nimport {\r\n  ARTICLE_TABS,\r\n  CATEGORY_ALL,\r\n  ARTICLE_TABS_OPTIONS,\r\n} from 'dashboard/helper/portalHelper';\r\n\r\nimport TabBar from 'dashboard/components-next/tabbar/TabBar.vue';\r\nimport Button from 'dashboard/components-next/button/Button.vue';\r\nimport DropdownMenu from 'dashboard/components-next/dropdown-menu/DropdownMenu.vue';\r\n\r\nconst props = defineProps({\r\n  categories: {\r\n    type: Array,\r\n    required: true,\r\n  },\r\n  allowedLocales: {\r\n    type: Array,\r\n    required: true,\r\n  },\r\n  meta: {\r\n    type: Object,\r\n    required: true,\r\n  },\r\n});\r\n\r\nconst emit = defineEmits([\r\n  'tabChange',\r\n  'localeChange',\r\n  'categoryChange',\r\n  'newArticle',\r\n]);\r\n\r\nconst route = useRoute();\r\nconst { t } = useI18n();\r\nconst { updateUISettings } = useUISettings();\r\n\r\nconst isCategoryMenuOpen = ref(false);\r\nconst isLocaleMenuOpen = ref(false);\r\n\r\nconst countKey = tab => {\r\n  if (tab.value === 'all') {\r\n    return 'articlesCount';\r\n  }\r\n  return `${tab.value}ArticlesCount`;\r\n};\r\n\r\nconst tabs = computed(() => {\r\n  return ARTICLE_TABS_OPTIONS.map(tab => ({\r\n    label: t(`HELP_CENTER.ARTICLES_PAGE.ARTICLES_HEADER.TABS.${tab.key}`),\r\n    value: tab.value,\r\n    count: props.meta[countKey(tab)],\r\n  }));\r\n});\r\n\r\nconst activeTabIndex = computed(() => {\r\n  const tabParam = route.params.tab || ARTICLE_TABS.ALL;\r\n  return tabs.value.findIndex(tab => tab.value === tabParam);\r\n});\r\n\r\nconst activeCategoryName = computed(() => {\r\n  const activeCategory = props.categories.find(\r\n    category => category.slug === route.params.categorySlug\r\n  );\r\n\r\n  if (activeCategory) {\r\n    const { icon, name } = activeCategory;\r\n    return `${icon} ${name}`;\r\n  }\r\n\r\n  return t('HELP_CENTER.ARTICLES_PAGE.ARTICLES_HEADER.CATEGORY.ALL');\r\n});\r\n\r\nconst activeLocaleName = computed(() => {\r\n  return props.allowedLocales.find(\r\n    locale => locale.code === route.params.locale\r\n  )?.name;\r\n});\r\n\r\nconst categoryMenuItems = computed(() => {\r\n  const defaultMenuItem = {\r\n    label: t('HELP_CENTER.ARTICLES_PAGE.ARTICLES_HEADER.CATEGORY.ALL'),\r\n    value: CATEGORY_ALL,\r\n    action: 'filter',\r\n  };\r\n\r\n  const categoryItems = props.categories.map(category => ({\r\n    label: category.name,\r\n    value: category.slug,\r\n    action: 'filter',\r\n    emoji: category.icon,\r\n  }));\r\n\r\n  const hasCategorySlug = !!route.params.categorySlug;\r\n\r\n  return hasCategorySlug ? [defaultMenuItem, ...categoryItems] : categoryItems;\r\n});\r\n\r\nconst hasCategoryMenuItems = computed(() => {\r\n  return categoryMenuItems.value?.length > 0;\r\n});\r\n\r\nconst localeMenuItems = computed(() => {\r\n  return props.allowedLocales.map(locale => ({\r\n    label: locale.name,\r\n    value: locale.code,\r\n    action: 'filter',\r\n  }));\r\n});\r\n\r\nconst handleLocaleAction = ({ value }) => {\r\n  emit('localeChange', value);\r\n  isLocaleMenuOpen.value = false;\r\n  updateUISettings({\r\n    last_active_locale_code: value,\r\n  });\r\n};\r\n\r\nconst handleCategoryAction = ({ value }) => {\r\n  emit('categoryChange', value);\r\n  isCategoryMenuOpen.value = false;\r\n};\r\n\r\nconst handleNewArticle = () => {\r\n  emit('newArticle');\r\n};\r\n\r\nconst handleTabChange = value => {\r\n  emit('tabChange', value);\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-col items-start w-full gap-2 lg:flex-row\">\r\n    <TabBar\r\n      :tabs=\"tabs\"\r\n      :initial-active-tab=\"activeTabIndex\"\r\n      @tab-changed=\"handleTabChange\"\r\n    />\r\n    <div class=\"flex items-start justify-between w-full gap-2\">\r\n      <div class=\"flex items-center gap-2\">\r\n        <div class=\"relative group\">\r\n          <OnClickOutside @trigger=\"isLocaleMenuOpen = false\">\r\n            <Button\r\n              :label=\"activeLocaleName\"\r\n              size=\"sm\"\r\n              icon=\"i-lucide-chevron-down\"\r\n              color=\"slate\"\r\n              trailing-icon\r\n              @click=\"isLocaleMenuOpen = !isLocaleMenuOpen\"\r\n            />\r\n\r\n            <DropdownMenu\r\n              v-if=\"isLocaleMenuOpen\"\r\n              :menu-items=\"localeMenuItems\"\r\n              show-search\r\n              class=\"left-0 w-40 max-w-[300px] mt-2 overflow-y-auto xl:right-0 top-full max-h-60\"\r\n              @action=\"handleLocaleAction\"\r\n            />\r\n          </OnClickOutside>\r\n        </div>\r\n        <div v-if=\"hasCategoryMenuItems\" class=\"relative group\">\r\n          <OnClickOutside @trigger=\"isCategoryMenuOpen = false\">\r\n            <Button\r\n              :label=\"activeCategoryName\"\r\n              icon=\"i-lucide-chevron-down\"\r\n              size=\"sm\"\r\n              color=\"slate\"\r\n              trailing-icon\r\n              class=\"max-w-48\"\r\n              @click=\"isCategoryMenuOpen = !isCategoryMenuOpen\"\r\n            />\r\n\r\n            <DropdownMenu\r\n              v-if=\"isCategoryMenuOpen\"\r\n              :menu-items=\"categoryMenuItems\"\r\n              show-search\r\n              class=\"left-0 w-48 mt-2 overflow-y-auto xl:right-0 top-full max-h-60\"\r\n              @action=\"handleCategoryAction\"\r\n            />\r\n          </OnClickOutside>\r\n        </div>\r\n      </div>\r\n      <Button\r\n        :label=\"t('HELP_CENTER.ARTICLES_PAGE.ARTICLES_HEADER.NEW_ARTICLE')\"\r\n        icon=\"i-lucide-plus\"\r\n        size=\"sm\"\r\n        @click=\"handleNewArticle\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n","<script setup>\r\nimport EmptyStateLayout from 'dashboard/components-next/EmptyStateLayout.vue';\r\nimport Button from 'dashboard/components-next/button/Button.vue';\r\nimport ArticleCard from 'dashboard/components-next/HelpCenter/ArticleCard/ArticleCard.vue';\r\nimport articleContent from 'dashboard/components-next/HelpCenter/EmptyState/Portal/portalEmptyStateContent.js';\r\n\r\ndefineProps({\r\n  title: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n  subtitle: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n  showButton: {\r\n    type: Boolean,\r\n    default: true,\r\n  },\r\n  buttonLabel: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n});\r\n\r\nconst emit = defineEmits(['click']);\r\n\r\nconst onClick = () => {\r\n  emit('click');\r\n};\r\n</script>\r\n\r\n<template>\r\n  <EmptyStateLayout :title=\"title\" :subtitle=\"subtitle\">\r\n    <template #empty-state-item>\r\n      <div class=\"grid grid-cols-1 gap-4 p-px overflow-hidden\">\r\n        <ArticleCard\r\n          v-for=\"(article, index) in articleContent.slice(0, 5)\"\r\n          :id=\"article.id\"\r\n          :key=\"`article-${index}`\"\r\n          :title=\"article.title\"\r\n          :status=\"article.status\"\r\n          :updated-at=\"article.updatedAt\"\r\n          :author=\"article.author\"\r\n          :category=\"article.category\"\r\n          :views=\"article.views\"\r\n        />\r\n      </div>\r\n    </template>\r\n    <template #actions>\r\n      <div v-if=\"showButton\">\r\n        <Button :label=\"buttonLabel\" icon=\"i-lucide-plus\" @click=\"onClick\" />\r\n      </div>\r\n    </template>\r\n  </EmptyStateLayout>\r\n</template>\r\n","<script setup>\r\nimport { computed } from 'vue';\r\nimport { useRouter, useRoute } from 'vue-router';\r\nimport { useI18n } from 'vue-i18n';\r\nimport { useMapGetter } from 'dashboard/composables/store.js';\r\nimport { ARTICLE_TABS, CATEGORY_ALL } from 'dashboard/helper/portalHelper';\r\n\r\nimport HelpCenterLayout from 'dashboard/components-next/HelpCenter/HelpCenterLayout.vue';\r\nimport ArticleList from 'dashboard/components-next/HelpCenter/Pages/ArticlePage/ArticleList.vue';\r\nimport ArticleHeaderControls from 'dashboard/components-next/HelpCenter/Pages/ArticlePage/ArticleHeaderControls.vue';\r\nimport CategoryHeaderControls from 'dashboard/components-next/HelpCenter/Pages/CategoryPage/CategoryHeaderControls.vue';\r\nimport Spinner from 'dashboard/components-next/spinner/Spinner.vue';\r\nimport ArticleEmptyState from 'dashboard/components-next/HelpCenter/EmptyState/Article/ArticleEmptyState.vue';\r\n\r\nconst props = defineProps({\r\n  articles: {\r\n    type: Array,\r\n    required: true,\r\n  },\r\n  categories: {\r\n    type: Array,\r\n    required: true,\r\n  },\r\n  allowedLocales: {\r\n    type: Array,\r\n    required: true,\r\n  },\r\n  portalName: {\r\n    type: String,\r\n    required: true,\r\n  },\r\n  meta: {\r\n    type: Object,\r\n    required: true,\r\n  },\r\n  isCategoryArticles: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n});\r\n\r\nconst emit = defineEmits(['pageChange', 'fetchPortal']);\r\n\r\nconst router = useRouter();\r\nconst route = useRoute();\r\nconst { t } = useI18n();\r\n\r\nconst isSwitchingPortal = useMapGetter('portals/isSwitchingPortal');\r\nconst isFetching = useMapGetter('articles/isFetching');\r\n\r\nconst hasNoArticles = computed(\r\n  () => !isFetching.value && !props.articles.length\r\n);\r\n\r\nconst isLoading = computed(() => isFetching.value || isSwitchingPortal.value);\r\n\r\nconst totalArticlesCount = computed(() => props.meta.allArticlesCount);\r\n\r\nconst hasNoArticlesInPortal = computed(\r\n  () => totalArticlesCount.value === 0 && !props.isCategoryArticles\r\n);\r\n\r\nconst shouldShowPaginationFooter = computed(() => {\r\n  return !(isFetching.value || isSwitchingPortal.value || hasNoArticles.value);\r\n});\r\n\r\nconst updateRoute = newParams => {\r\n  const { portalSlug, locale, tab, categorySlug } = route.params;\r\n  router.push({\r\n    name: 'portals_articles_index',\r\n    params: {\r\n      portalSlug,\r\n      locale: newParams.locale ?? locale,\r\n      tab: newParams.tab ?? tab,\r\n      categorySlug: newParams.categorySlug ?? categorySlug,\r\n      ...newParams,\r\n    },\r\n  });\r\n};\r\n\r\nconst articlesCount = computed(() => {\r\n  const { tab } = route.params;\r\n  const { meta } = props;\r\n  const countMap = {\r\n    '': meta.articlesCount,\r\n    mine: meta.mineArticlesCount,\r\n    draft: meta.draftArticlesCount,\r\n    archived: meta.archivedArticlesCount,\r\n  };\r\n  return Number(countMap[tab] || countMap['']);\r\n});\r\n\r\nconst showArticleHeaderControls = computed(\r\n  () => !props.isCategoryArticles && !isSwitchingPortal.value\r\n);\r\n\r\nconst showCategoryHeaderControls = computed(\r\n  () => props.isCategoryArticles && !isSwitchingPortal.value\r\n);\r\n\r\nconst getEmptyStateText = type => {\r\n  if (props.isCategoryArticles) {\r\n    return t(`HELP_CENTER.ARTICLES_PAGE.EMPTY_STATE.CATEGORY.${type}`);\r\n  }\r\n  const tabName = route.params.tab?.toUpperCase() || 'ALL';\r\n  return t(`HELP_CENTER.ARTICLES_PAGE.EMPTY_STATE.${tabName}.${type}`);\r\n};\r\n\r\nconst getEmptyStateTitle = computed(() => getEmptyStateText('TITLE'));\r\nconst getEmptyStateSubtitle = computed(() => getEmptyStateText('SUBTITLE'));\r\n\r\nconst handleTabChange = tab =>\r\n  updateRoute({ tab: tab.value === ARTICLE_TABS.ALL ? '' : tab.value });\r\n\r\nconst handleCategoryAction = value =>\r\n  updateRoute({ categorySlug: value === CATEGORY_ALL ? '' : value });\r\n\r\nconst handleLocaleAction = value => {\r\n  updateRoute({ locale: value, categorySlug: '' });\r\n  emit('fetchPortal', value);\r\n};\r\nconst handlePageChange = page => emit('pageChange', page);\r\n\r\nconst navigateToNewArticlePage = () => {\r\n  const { categorySlug, locale } = route.params;\r\n  router.push({\r\n    name: 'portals_articles_new',\r\n    params: { categorySlug, locale },\r\n  });\r\n};\r\n</script>\r\n\r\n<template>\r\n  <HelpCenterLayout\r\n    :current-page=\"Number(meta.currentPage)\"\r\n    :total-items=\"articlesCount\"\r\n    :items-per-page=\"25\"\r\n    :header=\"portalName\"\r\n    :show-pagination-footer=\"shouldShowPaginationFooter\"\r\n    @update:current-page=\"handlePageChange\"\r\n  >\r\n    <template #header-actions>\r\n      <div class=\"flex items-end justify-between\">\r\n        <ArticleHeaderControls\r\n          v-if=\"showArticleHeaderControls\"\r\n          :categories=\"categories\"\r\n          :allowed-locales=\"allowedLocales\"\r\n          :meta=\"meta\"\r\n          @tab-change=\"handleTabChange\"\r\n          @locale-change=\"handleLocaleAction\"\r\n          @category-change=\"handleCategoryAction\"\r\n          @new-article=\"navigateToNewArticlePage\"\r\n        />\r\n        <CategoryHeaderControls\r\n          v-else-if=\"showCategoryHeaderControls\"\r\n          :categories=\"categories\"\r\n          :allowed-locales=\"allowedLocales\"\r\n          :has-selected-category=\"isCategoryArticles\"\r\n        />\r\n      </div>\r\n    </template>\r\n    <template #content>\r\n      <div\r\n        v-if=\"isLoading\"\r\n        class=\"flex items-center justify-center py-10 text-n-slate-11\"\r\n      >\r\n        <Spinner />\r\n      </div>\r\n      <ArticleList\r\n        v-else-if=\"!hasNoArticles\"\r\n        :articles=\"articles\"\r\n        :is-category-articles=\"isCategoryArticles\"\r\n      />\r\n      <ArticleEmptyState\r\n        v-else\r\n        class=\"pt-14\"\r\n        :title=\"getEmptyStateTitle\"\r\n        :subtitle=\"getEmptyStateSubtitle\"\r\n        :show-button=\"hasNoArticlesInPortal\"\r\n        :button-label=\"\r\n          t('HELP_CENTER.ARTICLES_PAGE.EMPTY_STATE.ALL.BUTTON_LABEL')\r\n        \"\r\n        @click=\"navigateToNewArticlePage\"\r\n      />\r\n    </template>\r\n  </HelpCenterLayout>\r\n</template>\r\n","<script setup>\r\nimport { computed, ref, onMounted, watch } from 'vue';\r\nimport { useRoute } from 'vue-router';\r\nimport { useMapGetter, useStore } from 'dashboard/composables/store.js';\r\nimport allLocales from 'shared/constants/locales.js';\r\nimport { getArticleStatus } from 'dashboard/helper/portalHelper.js';\r\nimport ArticlesPage from 'dashboard/components-next/HelpCenter/Pages/ArticlePage/ArticlesPage.vue';\r\n\r\nconst route = useRoute();\r\nconst store = useStore();\r\n\r\nconst pageNumber = ref(1);\r\n\r\nconst articles = useMapGetter('articles/allArticles');\r\nconst categories = useMapGetter('categories/allCategories');\r\nconst meta = useMapGetter('articles/getMeta');\r\nconst portalMeta = useMapGetter('portals/getMeta');\r\nconst currentUserId = useMapGetter('getCurrentUserID');\r\nconst getPortalBySlug = useMapGetter('portals/portalBySlug');\r\n\r\nconst selectedPortalSlug = computed(() => route.params.portalSlug);\r\nconst selectedCategorySlug = computed(() => route.params.categorySlug);\r\nconst status = computed(() => getArticleStatus(route.params.tab));\r\n\r\nconst author = computed(() =>\r\n  route.params.tab === 'mine' ? currentUserId.value : null\r\n);\r\n\r\nconst activeLocale = computed(() => route.params.locale);\r\nconst portal = computed(() => getPortalBySlug.value(selectedPortalSlug.value));\r\nconst allowedLocales = computed(() => {\r\n  if (!portal.value) {\r\n    return [];\r\n  }\r\n  const { allowed_locales: allAllowedLocales } = portal.value.config;\r\n  return allAllowedLocales.map(locale => {\r\n    return {\r\n      id: locale.code,\r\n      name: allLocales[locale.code],\r\n      code: locale.code,\r\n    };\r\n  });\r\n});\r\n\r\nconst defaultPortalLocale = computed(() => {\r\n  return portal.value?.meta?.default_locale;\r\n});\r\n\r\nconst selectedLocaleInPortal = computed(() => {\r\n  return route.params.locale || defaultPortalLocale.value;\r\n});\r\n\r\nconst isCategoryArticles = computed(() => {\r\n  return (\r\n    route.name === 'portals_categories_articles_index' ||\r\n    route.name === 'portals_categories_articles_edit' ||\r\n    route.name === 'portals_categories_index'\r\n  );\r\n});\r\n\r\nconst fetchArticles = ({ pageNumber: pageNumberParam } = {}) => {\r\n  store.dispatch('articles/index', {\r\n    pageNumber: pageNumberParam || pageNumber.value,\r\n    portalSlug: selectedPortalSlug.value,\r\n    locale: activeLocale.value,\r\n    status: status.value,\r\n    authorId: author.value,\r\n    categorySlug: selectedCategorySlug.value,\r\n  });\r\n};\r\n\r\nconst onPageChange = pageNumberParam => {\r\n  fetchArticles({ pageNumber: pageNumberParam });\r\n};\r\n\r\nconst fetchPortalAndItsCategories = async locale => {\r\n  await store.dispatch('portals/index');\r\n  const selectedPortalParam = {\r\n    portalSlug: selectedPortalSlug.value,\r\n    locale: locale || selectedLocaleInPortal.value,\r\n  };\r\n  store.dispatch('portals/show', selectedPortalParam);\r\n  store.dispatch('categories/index', selectedPortalParam);\r\n  store.dispatch('agents/get');\r\n};\r\n\r\nonMounted(() => {\r\n  fetchArticles();\r\n});\r\n\r\nwatch(\r\n  () => route.params,\r\n  () => {\r\n    pageNumber.value = 1;\r\n    fetchArticles();\r\n  },\r\n  { deep: true, immediate: true }\r\n);\r\n</script>\r\n\r\n<template>\r\n  <div class=\"w-full h-full\">\r\n    <ArticlesPage\r\n      v-if=\"portal\"\r\n      :articles=\"articles\"\r\n      :portal-name=\"portal.name\"\r\n      :categories=\"categories\"\r\n      :allowed-locales=\"allowedLocales\"\r\n      :meta=\"meta\"\r\n      :portal-meta=\"portalMeta\"\r\n      :is-category-articles=\"isCategoryArticles\"\r\n      @page-change=\"onPageChange\"\r\n      @fetch-portal=\"fetchPortalAndItsCategories\"\r\n    />\r\n  </div>\r\n</template>\r\n"],"names":["props","__props","ARTICLE_STATUS_TYPES","wootConstants","router","useRouter","route","useRoute","store","useStore","t","useI18n","localArticles","ref","dragEnabled","computed","_a","getCategoryById","useMapGetter","openArticle","id","tab","categorySlug","locale","onReorder","reorderedGroup","onDragEnd","sortedArticlePositions","article","a","b","obj","key","index","getCategory","categoryId","getStatusMessage","status","isSuccess","messageType","statusMap","updatePortalMeta","portalSlug","updateArticlesMeta","handleArticleAction","action","useAlert","useTrack","PORTALS_EVENTS","error","errorMessage","updateArticle","value","getArticleStatus","watch","newArticles","emit","__emit","updateUISettings","useUISettings","isCategoryMenuOpen","isLocaleMenuOpen","countKey","tabs","ARTICLE_TABS_OPTIONS","activeTabIndex","tabParam","ARTICLE_TABS","activeCategoryName","activeCategory","category","icon","name","activeLocaleName","categoryMenuItems","defaultMenuItem","CATEGORY_ALL","categoryItems","hasCategoryMenuItems","localeMenuItems","handleLocaleAction","handleCategoryAction","handleNewArticle","handleTabChange","onClick","isSwitchingPortal","isFetching","hasNoArticles","isLoading","totalArticlesCount","hasNoArticlesInPortal","shouldShowPaginationFooter","updateRoute","newParams","articlesCount","meta","countMap","showArticleHeaderControls","showCategoryHeaderControls","getEmptyStateText","type","tabName","getEmptyStateTitle","getEmptyStateSubtitle","handlePageChange","page","navigateToNewArticlePage","pageNumber","articles","categories","portalMeta","currentUserId","getPortalBySlug","selectedPortalSlug","selectedCategorySlug","author","activeLocale","portal","allowedLocales","allAllowedLocales","allLocales","defaultPortalLocale","_b","selectedLocaleInPortal","isCategoryArticles","fetchArticles","pageNumberParam","onPageChange","fetchPortalAndItsCategories","selectedPortalParam","onMounted"],"mappings":"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"}