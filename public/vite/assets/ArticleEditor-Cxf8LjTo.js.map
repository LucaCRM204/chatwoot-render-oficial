{"version":3,"file":"ArticleEditor-Cxf8LjTo.js","sources":["../../../node_modules/.pnpm/@chatwoot+prosemirror-schema@1.1.1-next/node_modules/@chatwoot/prosemirror-schema/src/plugins/image.js","../../../app/javascript/dashboard/components/widgets/WootWriter/FullEditor.vue","../../../app/javascript/dashboard/components-next/HelpCenter/Pages/ArticleEditorPage/ArticleEditorHeader.vue","../../../app/javascript/dashboard/components-next/HelpCenter/Pages/ArticleEditorPage/ArticleEditorProperties.vue","../../../app/javascript/dashboard/components-next/HelpCenter/Pages/ArticleEditorPage/ArticleEditorControls.vue","../../../app/javascript/dashboard/components-next/HelpCenter/Pages/ArticleEditorPage/ArticleEditor.vue"],"sourcesContent":["import { Plugin } from \"prosemirror-state\";\n\n/**\n * Replaces an image node in the editor with a new image URL.\n *\n * @param {string} currentUrl - The current URL of the image to be replaced.\n * @param {string} newUrl - The new URL to replace the current image with.\n * @param {EditorView} view - The ProseMirror editor view.\n */\nfunction replaceImage(currentUrl, newUrl, view) {\n  view.state.doc.descendants((node, pos) => {\n    if (node.type.name === \"image\" && node.attrs.src === currentUrl) {\n      const tr = view.state.tr.setNodeMarkup(pos, null, {\n        ...node.attrs,\n        src: newUrl,\n      });\n      view.dispatch(tr);\n    }\n  });\n}\n\n/**\n * Creates a ProseMirror plugin that handles image pasting and uploading.\n *\n * @param {Function} uploadImage - A function that takes an image URL and returns a Promise\n * that resolves to the new URL after uploading.\n * @returns {Plugin} A ProseMirror plugin that handles image pasting.\n */\nconst imagePastePlugin = (uploadImage) =>\n  new Plugin({\n    props: {\n      /**\n       * Handles the paste event in the editor.\n       *\n       * @param {EditorView} view - The ProseMirror editor view.\n       * @param {Event} event - The paste event.\n       * @param {Slice} slice - The ProseMirror Slice object representing the pasted content.\n       */\n      handlePaste(view, event, slice) {\n        const imageUrls = [];\n        slice.content.descendants((node) => {\n          if (node.type.name === \"image\") {\n            imageUrls.push(node.attrs.src);\n          }\n        });\n        Promise.all(imageUrls.map(async (url) => {\n          try {\n            const newUrl = await uploadImage(url);\n            replaceImage(url, newUrl, view);\n          } catch (error) {\n            console.error(\"Error uploading image:\", error);\n          }\n        }));\n      },\n    },\n  });\n\nexport default imagePastePlugin;\n","<script>\r\nimport {\r\n  fullSchema,\r\n  buildEditor,\r\n  EditorView,\r\n  ArticleMarkdownSerializer,\r\n  ArticleMarkdownTransformer,\r\n  EditorState,\r\n  Selection,\r\n} from '@chatwoot/prosemirror-schema';\r\nimport imagePastePlugin from '@chatwoot/prosemirror-schema/src/plugins/image';\r\nimport { checkFileSizeLimit } from 'shared/helpers/FileHelper';\r\nimport { useAlert } from 'dashboard/composables';\r\nimport { useUISettings } from 'dashboard/composables/useUISettings';\r\nimport keyboardEventListenerMixins from 'shared/mixins/keyboardEventListenerMixins';\r\n\r\nconst MAXIMUM_FILE_UPLOAD_SIZE = 4; // in MB\r\nconst createState = (\r\n  content,\r\n  placeholder,\r\n  // eslint-disable-next-line default-param-last\r\n  plugins = [],\r\n  // eslint-disable-next-line default-param-last\r\n  methods = {},\r\n  enabledMenuOptions\r\n) => {\r\n  return EditorState.create({\r\n    doc: new ArticleMarkdownTransformer(fullSchema).parse(content),\r\n    plugins: buildEditor({\r\n      schema: fullSchema,\r\n      placeholder,\r\n      methods,\r\n      plugins,\r\n      enabledMenuOptions,\r\n    }),\r\n  });\r\n};\r\n\r\nlet editorView = null;\r\nlet state;\r\n\r\nexport default {\r\n  mixins: [keyboardEventListenerMixins],\r\n  props: {\r\n    modelValue: { type: String, default: '' },\r\n    editorId: { type: String, default: '' },\r\n    placeholder: { type: String, default: '' },\r\n    enabledMenuOptions: { type: Array, default: () => [] },\r\n    autofocus: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n  },\r\n  emits: ['blur', 'input', 'update:modelValue', 'keyup', 'focus', 'keydown'],\r\n  setup() {\r\n    const { uiSettings, updateUISettings } = useUISettings();\r\n\r\n    return {\r\n      uiSettings,\r\n      updateUISettings,\r\n    };\r\n  },\r\n  data() {\r\n    return {\r\n      plugins: [imagePastePlugin(this.handleImageUpload)],\r\n      isTextSelected: false, // Tracks text selection and prevents unnecessary re-renders on mouse selection\r\n    };\r\n  },\r\n  watch: {\r\n    modelValue(newValue = '') {\r\n      if (newValue !== this.contentFromEditor()) {\r\n        this.reloadState();\r\n      }\r\n    },\r\n    editorId() {\r\n      this.reloadState();\r\n    },\r\n  },\r\n\r\n  created() {\r\n    state = createState(\r\n      this.modelValue,\r\n      this.placeholder,\r\n      this.plugins,\r\n      { onImageUpload: this.openFileBrowser },\r\n      this.enabledMenuOptions\r\n    );\r\n  },\r\n  mounted() {\r\n    this.createEditorView();\r\n\r\n    editorView.updateState(state);\r\n    if (this.autofocus) {\r\n      this.focusEditorInputField();\r\n    }\r\n  },\r\n  methods: {\r\n    contentFromEditor() {\r\n      if (editorView) {\r\n        return ArticleMarkdownSerializer.serialize(editorView.state.doc);\r\n      }\r\n      return '';\r\n    },\r\n    openFileBrowser() {\r\n      this.$refs.imageUploadInput.click();\r\n    },\r\n    async handleImageUpload(url) {\r\n      try {\r\n        const fileUrl = await this.$store.dispatch(\r\n          'articles/uploadExternalImage',\r\n          {\r\n            portalSlug: this.$route.params.portalSlug,\r\n            url,\r\n          }\r\n        );\r\n\r\n        return fileUrl;\r\n      } catch (error) {\r\n        useAlert(\r\n          this.$t('HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.UN_AUTHORIZED_ERROR')\r\n        );\r\n        return '';\r\n      }\r\n    },\r\n    onFileChange() {\r\n      const file = this.$refs.imageUploadInput.files[0];\r\n\r\n      if (checkFileSizeLimit(file, MAXIMUM_FILE_UPLOAD_SIZE)) {\r\n        this.uploadImageToStorage(file);\r\n      } else {\r\n        useAlert(\r\n          this.$t('HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.ERROR_FILE_SIZE', {\r\n            size: MAXIMUM_FILE_UPLOAD_SIZE,\r\n          })\r\n        );\r\n      }\r\n\r\n      this.$refs.imageUploadInput.value = '';\r\n    },\r\n    async uploadImageToStorage(file) {\r\n      try {\r\n        const fileUrl = await this.$store.dispatch('articles/attachImage', {\r\n          portalSlug: this.$route.params.portalSlug,\r\n          file,\r\n        });\r\n\r\n        if (fileUrl) {\r\n          this.onImageUploadStart(fileUrl);\r\n        }\r\n      } catch (error) {\r\n        useAlert(this.$t('HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.ERROR'));\r\n      }\r\n    },\r\n    onImageUploadStart(fileUrl) {\r\n      const { selection } = editorView.state;\r\n      const from = selection.from;\r\n      const node = editorView.state.schema.nodes.image.create({\r\n        src: fileUrl,\r\n      });\r\n      const paragraphNode = editorView.state.schema.node('paragraph');\r\n      if (node) {\r\n        // Insert the image and the caption wrapped inside a paragraph\r\n        const tr = editorView.state.tr\r\n          .replaceSelectionWith(paragraphNode)\r\n          .insert(from + 1, node);\r\n\r\n        editorView.dispatch(tr.scrollIntoView());\r\n        this.focusEditorInputField();\r\n      }\r\n    },\r\n    reloadState() {\r\n      state = createState(\r\n        this.modelValue,\r\n        this.placeholder,\r\n        this.plugins,\r\n        { onImageUpload: this.openFileBrowser },\r\n        this.enabledMenuOptions\r\n      );\r\n      editorView.updateState(state);\r\n      this.focusEditorInputField();\r\n    },\r\n    createEditorView() {\r\n      editorView = new EditorView(this.$refs.editor, {\r\n        state: state,\r\n        dispatchTransaction: tx => {\r\n          state = state.apply(tx);\r\n          editorView.updateState(state);\r\n          if (tx.docChanged) {\r\n            this.emitOnChange();\r\n          }\r\n          this.checkSelection(state);\r\n        },\r\n        handleDOMEvents: {\r\n          keyup: this.onKeyup,\r\n          focus: this.onFocus,\r\n          blur: this.onBlur,\r\n          keydown: this.onKeydown,\r\n          paste: (view, event) => {\r\n            const data = event.clipboardData.files;\r\n            if (data.length > 0) {\r\n              data.forEach(file => {\r\n                // Check if the file is an image\r\n                if (file.type.includes('image')) {\r\n                  this.uploadImageToStorage(file);\r\n                }\r\n              });\r\n              event.preventDefault();\r\n            }\r\n          },\r\n        },\r\n      });\r\n    },\r\n    handleKeyEvents() {},\r\n    focusEditorInputField() {\r\n      const { tr } = editorView.state;\r\n      const selection = Selection.atEnd(tr.doc);\r\n\r\n      editorView.dispatch(tr.setSelection(selection));\r\n      editorView.focus();\r\n    },\r\n    emitOnChange() {\r\n      this.$emit('update:modelValue', this.contentFromEditor());\r\n      this.$emit('input', this.contentFromEditor());\r\n    },\r\n    onKeyup() {\r\n      this.$emit('keyup');\r\n    },\r\n    onKeydown() {\r\n      this.$emit('keydown');\r\n    },\r\n    onBlur() {\r\n      this.$emit('blur');\r\n    },\r\n    onFocus() {\r\n      this.$emit('focus');\r\n    },\r\n    checkSelection(editorState) {\r\n      const { from, to } = editorState.selection;\r\n      // Check if there's a selection (from and to are different)\r\n      const hasSelection = from !== to;\r\n      // If the selection state is the same as the previous state, do nothing\r\n      if (hasSelection === this.isTextSelected) return;\r\n      // Update the selection state\r\n      this.isTextSelected = hasSelection;\r\n\r\n      const { editor } = this.$refs;\r\n\r\n      // Toggle the 'has-selection' class based on whether there's a selection\r\n      editor.classList.toggle('has-selection', hasSelection);\r\n      // If there's a selection, update the menubar position\r\n      if (hasSelection) this.setMenubarPosition(editorState);\r\n    },\r\n    setMenubarPosition(editorState) {\r\n      if (!editorState.selection) return;\r\n\r\n      // Get the start and end positions of the selection\r\n      const { from, to } = editorState.selection;\r\n      const { editor } = this.$refs;\r\n      // Get the editor's position relative to the viewport\r\n      const { left: editorLeft, top: editorTop } =\r\n        editor.getBoundingClientRect();\r\n\r\n      // Get the editor's width\r\n      const editorWidth = editor.offsetWidth;\r\n      const menubarWidth = 480; // Menubar width (adjust as needed (px))\r\n\r\n      // Get the end position of the selection\r\n      const { bottom: endBottom, right: endRight } = editorView.coordsAtPos(to);\r\n      // Get the start position of the selection\r\n      const { left: startLeft } = editorView.coordsAtPos(from);\r\n\r\n      // Calculate the top position for the menubar (10px below the selection)\r\n      const top = endBottom - editorTop + 10;\r\n      // Calculate the left position for the menubar\r\n      // This centers the menubar on the selection while keeping it within the editor's bounds\r\n      const left = Math.max(\r\n        0,\r\n        Math.min(\r\n          (startLeft + endRight) / 2 - editorLeft,\r\n          editorWidth - menubarWidth\r\n        )\r\n      );\r\n      // Set the CSS custom properties for positioning the menubar\r\n      editor.style.setProperty('--selection-top', `${top}px`);\r\n      editor.style.setProperty('--selection-left', `${left}px`);\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <div class=\"editor-root editor--article\">\r\n      <input\r\n        ref=\"imageUploadInput\"\r\n        type=\"file\"\r\n        accept=\"image/png, image/jpeg, image/jpg, image/gif, image/webp\"\r\n        hidden\r\n        @change=\"onFileChange\"\r\n      />\r\n      <div ref=\"editor\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n@import '@chatwoot/prosemirror-schema/src/styles/article.scss';\r\n\r\n.ProseMirror-menubar-wrapper {\r\n  display: flex;\r\n  flex-direction: column;\r\n\r\n  > .ProseMirror {\r\n    padding: 0;\r\n    word-break: break-word;\r\n  }\r\n}\r\n\r\n.editor-root {\r\n  position: relative;\r\n  width: 100%;\r\n}\r\n\r\n.ProseMirror-woot-style {\r\n  min-height: 5rem;\r\n  max-height: 7.5rem;\r\n  overflow: auto;\r\n}\r\n\r\n.ProseMirror-prompt {\r\n  @apply z-[9999] bg-n-alpha-3 min-w-80 backdrop-blur-[100px] border border-n-strong p-6 shadow-xl rounded-xl;\r\n\r\n  h5 {\r\n    @apply text-n-slate-12 mb-1.5;\r\n  }\r\n\r\n  .ProseMirror-prompt-buttons {\r\n    button {\r\n      @apply h-8 px-3;\r\n\r\n      &[type='submit'] {\r\n        @apply bg-n-brand text-white hover:bg-n-brand/90;\r\n      }\r\n\r\n      &[type='button'] {\r\n        @apply bg-n-slate-9/10 text-n-slate-12 hover:bg-n-slate-9/20;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","<script setup>\r\nimport { computed, ref } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\nimport { useRoute } from 'vue-router';\r\nimport { useStore } from 'dashboard/composables/store.js';\r\nimport { useAlert, useTrack } from 'dashboard/composables';\r\nimport { PORTALS_EVENTS } from 'dashboard/helper/AnalyticsHelper/events';\r\nimport { OnClickOutside } from '@vueuse/components';\r\nimport { getArticleStatus } from 'dashboard/helper/portalHelper.js';\r\nimport {\r\n  ARTICLE_EDITOR_STATUS_OPTIONS,\r\n  ARTICLE_STATUSES,\r\n  ARTICLE_MENU_ITEMS,\r\n} from 'dashboard/helper/portalHelper';\r\nimport wootConstants from 'dashboard/constants/globals';\r\n\r\nimport Button from 'dashboard/components-next/button/Button.vue';\r\nimport DropdownMenu from 'dashboard/components-next/dropdown-menu/DropdownMenu.vue';\r\n\r\nconst props = defineProps({\r\n  isUpdating: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  isSaved: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  status: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n  articleId: {\r\n    type: Number,\r\n    default: 0,\r\n  },\r\n});\r\n\r\nconst emit = defineEmits(['goBack', 'previewArticle']);\r\n\r\nconst { t } = useI18n();\r\nconst store = useStore();\r\nconst route = useRoute();\r\n\r\nconst isArticlePublishing = ref(false);\r\n\r\nconst { ARTICLE_STATUS_TYPES } = wootConstants;\r\n\r\nconst showArticleActionMenu = ref(false);\r\n\r\nconst articleMenuItems = computed(() => {\r\n  const statusOptions = ARTICLE_EDITOR_STATUS_OPTIONS[props.status] ?? [];\r\n  return statusOptions.map(option => {\r\n    const { label, value, icon } = ARTICLE_MENU_ITEMS[option];\r\n    return {\r\n      label: t(label),\r\n      value,\r\n      action: 'update-status',\r\n      icon,\r\n    };\r\n  });\r\n});\r\n\r\nconst statusText = computed(() =>\r\n  t(\r\n    `HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.STATUS.${props.isUpdating ? 'SAVING' : 'SAVED'}`\r\n  )\r\n);\r\n\r\nconst onClickGoBack = () => emit('goBack');\r\n\r\nconst previewArticle = () => emit('previewArticle');\r\n\r\nconst getStatusMessage = (status, isSuccess) => {\r\n  const messageType = isSuccess ? 'SUCCESS' : 'ERROR';\r\n  const statusMap = {\r\n    [ARTICLE_STATUS_TYPES.PUBLISH]: 'PUBLISH_ARTICLE',\r\n    [ARTICLE_STATUS_TYPES.ARCHIVE]: 'ARCHIVE_ARTICLE',\r\n    [ARTICLE_STATUS_TYPES.DRAFT]: 'DRAFT_ARTICLE',\r\n  };\r\n\r\n  return statusMap[status]\r\n    ? t(`HELP_CENTER.${statusMap[status]}.API.${messageType}`)\r\n    : '';\r\n};\r\n\r\nconst updateArticleStatus = async ({ value }) => {\r\n  showArticleActionMenu.value = false;\r\n  const status = getArticleStatus(value);\r\n  if (status === ARTICLE_STATUS_TYPES.PUBLISH) {\r\n    isArticlePublishing.value = true;\r\n  }\r\n  const { portalSlug } = route.params;\r\n\r\n  try {\r\n    await store.dispatch('articles/update', {\r\n      portalSlug,\r\n      articleId: props.articleId,\r\n      status,\r\n    });\r\n\r\n    useAlert(getStatusMessage(status, true));\r\n\r\n    if (status === ARTICLE_STATUS_TYPES.ARCHIVE) {\r\n      useTrack(PORTALS_EVENTS.ARCHIVE_ARTICLE, { uiFrom: 'header' });\r\n    } else if (status === ARTICLE_STATUS_TYPES.PUBLISH) {\r\n      useTrack(PORTALS_EVENTS.PUBLISH_ARTICLE);\r\n    }\r\n    isArticlePublishing.value = false;\r\n  } catch (error) {\r\n    useAlert(error?.message ?? getStatusMessage(status, false));\r\n    isArticlePublishing.value = false;\r\n  }\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex items-center justify-between h-20\">\r\n    <Button\r\n      :label=\"t('HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.BACK_TO_ARTICLES')\"\r\n      icon=\"i-lucide-chevron-left\"\r\n      variant=\"link\"\r\n      color=\"slate\"\r\n      size=\"sm\"\r\n      class=\"ltr:pl-3 rtl:pr-3\"\r\n      @click=\"onClickGoBack\"\r\n    />\r\n    <div class=\"flex items-center gap-4\">\r\n      <span\r\n        v-if=\"isUpdating || isSaved\"\r\n        class=\"text-xs font-medium transition-all duration-300 text-slate-500 dark:text-slate-400\"\r\n      >\r\n        {{ statusText }}\r\n      </span>\r\n      <div class=\"flex items-center gap-2\">\r\n        <Button\r\n          :label=\"t('HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.PREVIEW')\"\r\n          color=\"slate\"\r\n          size=\"sm\"\r\n          :disabled=\"!articleId\"\r\n          @click=\"previewArticle\"\r\n        />\r\n        <div class=\"flex items-center\">\r\n          <Button\r\n            :label=\"t('HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.PUBLISH')\"\r\n            size=\"sm\"\r\n            class=\"ltr:rounded-r-none rtl:rounded-l-none\"\r\n            :is-loading=\"isArticlePublishing\"\r\n            :disabled=\"\r\n              status === ARTICLE_STATUSES.PUBLISHED ||\r\n              !articleId ||\r\n              isArticlePublishing\r\n            \"\r\n            @click=\"updateArticleStatus({ value: ARTICLE_STATUSES.PUBLISHED })\"\r\n          />\r\n          <div class=\"relative\">\r\n            <OnClickOutside @trigger=\"showArticleActionMenu = false\">\r\n              <Button\r\n                icon=\"i-lucide-chevron-down\"\r\n                size=\"sm\"\r\n                :disabled=\"!articleId\"\r\n                class=\"ltr:rounded-l-none rtl:rounded-r-none\"\r\n                @click.stop=\"showArticleActionMenu = !showArticleActionMenu\"\r\n              />\r\n              <DropdownMenu\r\n                v-if=\"showArticleActionMenu\"\r\n                :menu-items=\"articleMenuItems\"\r\n                class=\"mt-2 ltr:right-0 rtl:left-0 top-full\"\r\n                @action=\"updateArticleStatus($event)\"\r\n              />\r\n            </OnClickOutside>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n","<script setup>\r\nimport { reactive, watch, onMounted } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\nimport { debounce } from '@chatwoot/utils';\r\n\r\nimport InlineInput from 'dashboard/components-next/inline-input/InlineInput.vue';\r\nimport TextArea from 'dashboard/components-next/textarea/TextArea.vue';\r\nimport TagInput from 'dashboard/components-next/taginput/TagInput.vue';\r\nimport Button from 'dashboard/components-next/button/Button.vue';\r\n\r\nconst props = defineProps({\r\n  article: {\r\n    type: Object,\r\n    required: true,\r\n  },\r\n});\r\n\r\nconst emit = defineEmits(['saveArticle', 'close']);\r\n\r\nconst saveArticle = debounce(value => emit('saveArticle', value), 400, false);\r\n\r\nconst { t } = useI18n();\r\n\r\nconst state = reactive({\r\n  title: '',\r\n  description: '',\r\n  tags: [],\r\n});\r\n\r\nconst updateState = () => {\r\n  state.title = props.article.meta?.title || '';\r\n  state.description = props.article.meta?.description || '';\r\n  state.tags = props.article.meta?.tags || [];\r\n};\r\n\r\nwatch(\r\n  state,\r\n  newState => {\r\n    saveArticle({\r\n      title: newState.title,\r\n      description: newState.description,\r\n      tags: newState.tags,\r\n    });\r\n  },\r\n  { deep: true }\r\n);\r\n\r\nonMounted(() => {\r\n  updateState();\r\n});\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    class=\"flex flex-col absolute w-[25rem] bg-n-alpha-3 outline outline-1 outline-n-container backdrop-blur-[100px] shadow-lg gap-6 rounded-xl p-6\"\r\n  >\r\n    <div class=\"flex items-center justify-between\">\r\n      <h3>\r\n        {{\r\n          t(\r\n            'HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.ARTICLE_PROPERTIES'\r\n          )\r\n        }}\r\n      </h3>\r\n      <Button\r\n        icon=\"i-lucide-x\"\r\n        size=\"sm\"\r\n        variant=\"ghost\"\r\n        color=\"slate\"\r\n        class=\"hover:text-n-slate-11\"\r\n        @click=\"emit('close')\"\r\n      />\r\n    </div>\r\n    <div class=\"flex flex-col gap-2\">\r\n      <div>\r\n        <div class=\"flex justify-between w-full gap-4 py-2\">\r\n          <label\r\n            class=\"text-sm font-medium whitespace-nowrap min-w-[6.25rem] text-n-slate-12\"\r\n          >\r\n            {{\r\n              t(\r\n                'HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_DESCRIPTION'\r\n              )\r\n            }}\r\n          </label>\r\n          <TextArea\r\n            v-model=\"state.description\"\r\n            :placeholder=\"\r\n              t(\r\n                'HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_DESCRIPTION_PLACEHOLDER'\r\n              )\r\n            \"\r\n            class=\"w-[13.75rem]\"\r\n            custom-text-area-wrapper-class=\"!p-0 !border-0 !rounded-none !bg-transparent transition-none\"\r\n            custom-text-area-class=\"max-h-[9.375rem]\"\r\n            auto-height\r\n            min-height=\"3rem\"\r\n          />\r\n        </div>\r\n        <div class=\"flex justify-between w-full gap-2 py-2\">\r\n          <InlineInput\r\n            v-model=\"state.title\"\r\n            :placeholder=\"\r\n              t(\r\n                'HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TITLE_PLACEHOLDER'\r\n              )\r\n            \"\r\n            :label=\"\r\n              t('HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TITLE')\r\n            \"\r\n            custom-label-class=\"min-w-[7.5rem]\"\r\n          />\r\n        </div>\r\n        <div class=\"flex justify-between w-full gap-3 py-2\">\r\n          <label\r\n            class=\"text-sm font-medium whitespace-nowrap min-w-[7.5rem] text-n-slate-12\"\r\n          >\r\n            {{\r\n              t('HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TAGS')\r\n            }}\r\n          </label>\r\n          <TagInput\r\n            v-model=\"state.tags\"\r\n            :placeholder=\"\r\n              t(\r\n                'HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TAGS_PLACEHOLDER'\r\n              )\r\n            \"\r\n            class=\"w-[14rem]\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n","<script setup>\r\nimport { computed, ref, onMounted } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\nimport { useRoute } from 'vue-router';\r\nimport { OnClickOutside } from '@vueuse/components';\r\nimport { useMapGetter } from 'dashboard/composables/store';\r\n\r\nimport Button from 'dashboard/components-next/button/Button.vue';\r\nimport Avatar from 'dashboard/components-next/avatar/Avatar.vue';\r\nimport DropdownMenu from 'dashboard/components-next/dropdown-menu/DropdownMenu.vue';\r\nimport ArticleEditorProperties from 'dashboard/components-next/HelpCenter/Pages/ArticleEditorPage/ArticleEditorProperties.vue';\r\n\r\nconst props = defineProps({\r\n  article: {\r\n    type: Object,\r\n    default: () => ({}),\r\n  },\r\n});\r\n\r\nconst emit = defineEmits(['saveArticle', 'setAuthor', 'setCategory']);\r\n\r\nconst { t } = useI18n();\r\nconst route = useRoute();\r\n\r\nconst openAgentsList = ref(false);\r\nconst openCategoryList = ref(false);\r\nconst openProperties = ref(false);\r\nconst selectedAuthorId = ref(null);\r\nconst selectedCategoryId = ref(null);\r\n\r\nconst agents = useMapGetter('agents/getAgents');\r\nconst categories = useMapGetter('categories/allCategories');\r\nconst currentUserId = useMapGetter('getCurrentUserID');\r\n\r\nconst isNewArticle = computed(() => !props.article?.id);\r\n\r\nconst currentUser = computed(() =>\r\n  agents.value.find(agent => agent.id === currentUserId.value)\r\n);\r\n\r\nconst categorySlugFromRoute = computed(() => route.params.categorySlug);\r\n\r\nconst author = computed(() => {\r\n  if (isNewArticle.value) {\r\n    return selectedAuthorId.value\r\n      ? agents.value.find(agent => agent.id === selectedAuthorId.value)\r\n      : currentUser.value;\r\n  }\r\n  return props.article?.author || null;\r\n});\r\n\r\nconst authorName = computed(\r\n  () => author.value?.name || author.value?.available_name || ''\r\n);\r\nconst authorThumbnailSrc = computed(() => author.value?.thumbnail);\r\n\r\nconst agentList = computed(() => {\r\n  return (\r\n    agents.value\r\n      ?.map(({ name, id, thumbnail }) => ({\r\n        label: name,\r\n        value: id,\r\n        thumbnail: { name, src: thumbnail },\r\n        isSelected: props.article?.author?.id\r\n          ? id === props.article.author.id\r\n          : id === (selectedAuthorId.value || currentUserId.value),\r\n        action: 'assignAuthor',\r\n      }))\r\n      // Sort the list by isSelected first, then by name(label)\r\n      .toSorted((a, b) => {\r\n        if (a.isSelected !== b.isSelected) {\r\n          return Number(b.isSelected) - Number(a.isSelected);\r\n        }\r\n        return a.label.localeCompare(b.label);\r\n      }) ?? []\r\n  );\r\n});\r\n\r\nconst hasAgentList = computed(() => {\r\n  return agents.value?.length > 1;\r\n});\r\n\r\nconst findCategoryFromSlug = slug => {\r\n  return categories.value?.find(category => category.slug === slug);\r\n};\r\n\r\nconst assignCategoryFromSlug = slug => {\r\n  const categoryFromSlug = findCategoryFromSlug(slug);\r\n  if (categoryFromSlug) {\r\n    selectedCategoryId.value = categoryFromSlug.id;\r\n    return categoryFromSlug;\r\n  }\r\n  return null;\r\n};\r\n\r\nconst selectedCategory = computed(() => {\r\n  if (isNewArticle.value) {\r\n    if (categorySlugFromRoute.value) {\r\n      const categoryFromSlug = assignCategoryFromSlug(\r\n        categorySlugFromRoute.value\r\n      );\r\n      if (categoryFromSlug) return categoryFromSlug;\r\n    }\r\n    return selectedCategoryId.value\r\n      ? categories.value.find(\r\n          category => category.id === selectedCategoryId.value\r\n        )\r\n      : categories.value[0] || null;\r\n  }\r\n  return categories.value.find(\r\n    category => category.id === props.article?.category?.id\r\n  );\r\n});\r\n\r\nconst categoryList = computed(() => {\r\n  return (\r\n    categories.value\r\n      .map(({ name, id, icon }) => ({\r\n        label: name,\r\n        value: id,\r\n        emoji: icon,\r\n        isSelected: isNewArticle.value\r\n          ? id === (selectedCategoryId.value || selectedCategory.value?.id)\r\n          : id === props.article?.category?.id,\r\n        action: 'assignCategory',\r\n      }))\r\n      // Sort categories by isSelected\r\n      .toSorted((a, b) => Number(b.isSelected) - Number(a.isSelected))\r\n  );\r\n});\r\n\r\nconst hasCategoryMenuItems = computed(() => {\r\n  return categoryList.value?.length > 0;\r\n});\r\n\r\nconst handleArticleAction = ({ action, value }) => {\r\n  const actions = {\r\n    assignAuthor: () => {\r\n      if (isNewArticle.value) {\r\n        selectedAuthorId.value = value;\r\n        emit('setAuthor', value);\r\n      } else {\r\n        emit('saveArticle', { author_id: value });\r\n      }\r\n      openAgentsList.value = false;\r\n    },\r\n    assignCategory: () => {\r\n      if (isNewArticle.value) {\r\n        selectedCategoryId.value = value;\r\n        emit('setCategory', value);\r\n      } else {\r\n        emit('saveArticle', { category_id: value });\r\n      }\r\n      openCategoryList.value = false;\r\n    },\r\n  };\r\n\r\n  actions[action]?.();\r\n};\r\n\r\nconst updateMeta = meta => {\r\n  emit('saveArticle', { meta });\r\n};\r\n\r\nonMounted(() => {\r\n  if (categorySlugFromRoute.value && isNewArticle.value) {\r\n    // Assign category from slug if there is one\r\n    const categoryFromSlug = findCategoryFromSlug(categorySlugFromRoute.value);\r\n    if (categoryFromSlug) {\r\n      handleArticleAction({\r\n        action: 'assignCategory',\r\n        value: categoryFromSlug?.id,\r\n      });\r\n    }\r\n  }\r\n});\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex items-center gap-4\">\r\n    <div class=\"relative flex items-center gap-2\">\r\n      <OnClickOutside @trigger=\"openAgentsList = false\">\r\n        <Button\r\n          variant=\"ghost\"\r\n          color=\"slate\"\r\n          class=\"!px-0 font-normal hover:!bg-transparent\"\r\n          text-variant=\"info\"\r\n          @click=\"openAgentsList = !openAgentsList\"\r\n        >\r\n          <Avatar\r\n            :name=\"authorName\"\r\n            :src=\"authorThumbnailSrc\"\r\n            :size=\"20\"\r\n            rounded-full\r\n          />\r\n          <span class=\"text-sm text-n-slate-12 hover:text-n-slate-11\">\r\n            {{ authorName || '-' }}\r\n          </span>\r\n        </Button>\r\n        <DropdownMenu\r\n          v-if=\"openAgentsList && hasAgentList\"\r\n          :menu-items=\"agentList\"\r\n          show-search\r\n          class=\"z-[100] w-48 mt-2 overflow-y-auto ltr:left-0 rtl:right-0 top-full max-h-60\"\r\n          @action=\"handleArticleAction\"\r\n        />\r\n      </OnClickOutside>\r\n    </div>\r\n    <div class=\"w-px h-3 bg-slate-50 dark:bg-slate-800\" />\r\n    <div class=\"relative\">\r\n      <OnClickOutside @trigger=\"openCategoryList = false\">\r\n        <Button\r\n          :label=\"\r\n            selectedCategory?.name ||\r\n            t('HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.UNCATEGORIZED')\r\n          \"\r\n          :icon=\"!selectedCategory?.icon ? 'i-lucide-shapes' : ''\"\r\n          variant=\"ghost\"\r\n          color=\"slate\"\r\n          class=\"!px-2 font-normal hover:!bg-transparent\"\r\n          @click=\"openCategoryList = !openCategoryList\"\r\n        >\r\n          <span\r\n            v-if=\"selectedCategory\"\r\n            class=\"text-sm text-n-slate-12 hover:text-n-slate-11\"\r\n          >\r\n            {{\r\n              `${selectedCategory.icon || ''} ${selectedCategory.name || t('HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.UNCATEGORIZED')}`\r\n            }}\r\n          </span>\r\n        </Button>\r\n        <DropdownMenu\r\n          v-if=\"openCategoryList && hasCategoryMenuItems\"\r\n          :menu-items=\"categoryList\"\r\n          show-search\r\n          class=\"w-48 mt-2 z-[100] overflow-y-auto left-0 top-full max-h-60\"\r\n          @action=\"handleArticleAction\"\r\n        />\r\n      </OnClickOutside>\r\n    </div>\r\n\r\n    <div class=\"w-px h-3 bg-slate-50 dark:bg-slate-800\" />\r\n    <div class=\"relative\">\r\n      <OnClickOutside @trigger=\"openProperties = false\">\r\n        <Button\r\n          :label=\"\r\n            t('HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.MORE_PROPERTIES')\r\n          \"\r\n          icon=\"i-lucide-plus\"\r\n          variant=\"ghost\"\r\n          color=\"slate\"\r\n          :disabled=\"isNewArticle\"\r\n          class=\"!px-2 font-normal hover:!bg-transparent hover:!text-n-slate-11\"\r\n          @click=\"openProperties = !openProperties\"\r\n        />\r\n        <ArticleEditorProperties\r\n          v-if=\"openProperties\"\r\n          :article=\"article\"\r\n          class=\"right-0 z-[100] mt-2 xl:left-0 top-full\"\r\n          @save-article=\"updateMeta\"\r\n          @close=\"openProperties = false\"\r\n        />\r\n      </OnClickOutside>\r\n    </div>\r\n  </div>\r\n</template>\r\n","<script setup>\r\nimport { computed } from 'vue';\r\nimport { debounce } from '@chatwoot/utils';\r\nimport { useI18n } from 'vue-i18n';\r\nimport { ARTICLE_EDITOR_MENU_OPTIONS } from 'dashboard/constants/editor';\r\n\r\nimport HelpCenterLayout from 'dashboard/components-next/HelpCenter/HelpCenterLayout.vue';\r\nimport TextArea from 'dashboard/components-next/textarea/TextArea.vue';\r\nimport FullEditor from 'dashboard/components/widgets/WootWriter/FullEditor.vue';\r\nimport ArticleEditorHeader from 'dashboard/components-next/HelpCenter/Pages/ArticleEditorPage/ArticleEditorHeader.vue';\r\nimport ArticleEditorControls from 'dashboard/components-next/HelpCenter/Pages/ArticleEditorPage/ArticleEditorControls.vue';\r\n\r\nconst props = defineProps({\r\n  article: {\r\n    type: Object,\r\n    default: () => ({}),\r\n  },\r\n  isUpdating: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  isSaved: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n});\r\n\r\nconst emit = defineEmits([\r\n  'saveArticle',\r\n  'saveArticleAsync',\r\n  'goBack',\r\n  'setAuthor',\r\n  'setCategory',\r\n  'previewArticle',\r\n]);\r\n\r\nconst { t } = useI18n();\r\n\r\nconst isNewArticle = computed(() => !props.article?.id);\r\n\r\nconst saveAndSync = value => {\r\n  emit('saveArticle', value);\r\n};\r\n\r\n// this will only send the data to the backend\r\n// but will not update the local state preventing unnecessary re-renders\r\n// since the data is already saved and we keep the editor text as the source of truth\r\nconst quickSave = debounce(\r\n  value => emit('saveArticleAsync', value),\r\n  400,\r\n  false\r\n);\r\n\r\n// 2.5 seconds is enough to know that the user has stopped typing and is taking a pause\r\n// so we can save the data to the backend and retrieve the updated data\r\n// this will update the local state with response data\r\n// Only use to save for existing articles\r\nconst saveAndSyncDebounced = debounce(saveAndSync, 2500, false);\r\n\r\n// Debounced save for new articles\r\nconst quickSaveNewArticle = debounce(saveAndSync, 400, false);\r\n\r\nconst handleSave = value => {\r\n  if (isNewArticle.value) {\r\n    quickSaveNewArticle(value);\r\n  } else {\r\n    quickSave(value);\r\n    saveAndSyncDebounced(value);\r\n  }\r\n};\r\n\r\nconst articleTitle = computed({\r\n  get: () => props.article.title,\r\n  set: value => {\r\n    handleSave({ title: value });\r\n  },\r\n});\r\n\r\nconst articleContent = computed({\r\n  get: () => props.article.content,\r\n  set: content => {\r\n    handleSave({ content });\r\n  },\r\n});\r\n\r\nconst onClickGoBack = () => {\r\n  emit('goBack');\r\n};\r\n\r\nconst setAuthorId = authorId => {\r\n  emit('setAuthor', authorId);\r\n};\r\n\r\nconst setCategoryId = categoryId => {\r\n  emit('setCategory', categoryId);\r\n};\r\n\r\nconst previewArticle = () => {\r\n  emit('previewArticle');\r\n};\r\n</script>\r\n\r\n<template>\r\n  <HelpCenterLayout :show-header-title=\"false\" :show-pagination-footer=\"false\">\r\n    <template #header-actions>\r\n      <ArticleEditorHeader\r\n        :is-updating=\"isUpdating\"\r\n        :is-saved=\"isSaved\"\r\n        :status=\"article.status\"\r\n        :article-id=\"article.id\"\r\n        @go-back=\"onClickGoBack\"\r\n        @preview-article=\"previewArticle\"\r\n      />\r\n    </template>\r\n    <template #content>\r\n      <div class=\"flex flex-col gap-3 pl-4 mb-3 rtl:pr-3 rtl:pl-0\">\r\n        <TextArea\r\n          v-model=\"articleTitle\"\r\n          auto-height\r\n          min-height=\"4rem\"\r\n          custom-text-area-class=\"!text-[32px] !leading-[48px] !font-medium !tracking-[0.2px]\"\r\n          custom-text-area-wrapper-class=\"border-0 !bg-transparent dark:!bg-transparent !py-0 !px-0\"\r\n          placeholder=\"Title\"\r\n          autofocus\r\n        />\r\n        <ArticleEditorControls\r\n          :article=\"article\"\r\n          @save-article=\"saveAndSync\"\r\n          @set-author=\"setAuthorId\"\r\n          @set-category=\"setCategoryId\"\r\n        />\r\n      </div>\r\n      <FullEditor\r\n        v-model=\"articleContent\"\r\n        class=\"py-0 pb-10 pl-4 rtl:pr-4 rtl:pl-0 h-fit\"\r\n        :placeholder=\"\r\n          t('HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.EDITOR_PLACEHOLDER')\r\n        \"\r\n        :enabled-menu-options=\"ARTICLE_EDITOR_MENU_OPTIONS\"\r\n        :autofocus=\"false\"\r\n      />\r\n    </template>\r\n  </HelpCenterLayout>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n::v-deep {\r\n  .ProseMirror .empty-node::before {\r\n    @apply text-slate-200 dark:text-slate-500 text-base;\r\n  }\r\n\r\n  .ProseMirror-menubar-wrapper {\r\n    .ProseMirror-woot-style {\r\n      @apply min-h-[15rem] max-h-full;\r\n    }\r\n  }\r\n\r\n  .ProseMirror-menubar {\r\n    display: none; // Hide by default\r\n  }\r\n\r\n  .editor-root .has-selection {\r\n    .ProseMirror-menubar {\r\n      @apply h-8 rounded-lg !px-2 z-50 bg-slate-50 dark:bg-slate-800 items-center gap-4 ml-0 mb-0 shadow-md border border-slate-75 dark:border-slate-700/50;\r\n      display: flex;\r\n      top: var(--selection-top, auto) !important;\r\n      left: var(--selection-left, 0) !important;\r\n      width: fit-content !important;\r\n      position: absolute !important;\r\n\r\n      .ProseMirror-menuitem {\r\n        @apply mr-0;\r\n\r\n        .ProseMirror-icon {\r\n          @apply p-0 mt-1 !mr-0;\r\n\r\n          svg {\r\n            width: 20px !important;\r\n            height: 20px !important;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["replaceImage","currentUrl","newUrl","view","node","pos","tr","imagePastePlugin","uploadImage","Plugin","event","slice","imageUrls","url","error","MAXIMUM_FILE_UPLOAD_SIZE","createState","content","placeholder","plugins","methods","enabledMenuOptions","EditorState","ArticleMarkdownTransformer","fullSchema","buildEditor","editorView","state","_sfc_main","keyboardEventListenerMixins","uiSettings","updateUISettings","useUISettings","newValue","ArticleMarkdownSerializer","useAlert","file","checkFileSizeLimit","fileUrl","selection","from","paragraphNode","EditorView","tx","data","Selection","editorState","to","hasSelection","editor","editorLeft","editorTop","editorWidth","menubarWidth","endBottom","endRight","startLeft","top","left","_hoisted_1","_hoisted_2","_createElementBlock","_createElementVNode","$options","args","props","__props","emit","__emit","t","useI18n","store","useStore","route","useRoute","isArticlePublishing","ref","ARTICLE_STATUS_TYPES","wootConstants","showArticleActionMenu","articleMenuItems","computed","ARTICLE_EDITOR_STATUS_OPTIONS","option","label","value","icon","ARTICLE_MENU_ITEMS","statusText","onClickGoBack","previewArticle","getStatusMessage","status","isSuccess","messageType","statusMap","updateArticleStatus","getArticleStatus","portalSlug","useTrack","PORTALS_EVENTS","saveArticle","debounce","reactive","updateState","_a","_b","_c","watch","newState","onMounted","openAgentsList","openCategoryList","openProperties","selectedAuthorId","selectedCategoryId","agents","useMapGetter","categories","currentUserId","isNewArticle","currentUser","agent","categorySlugFromRoute","author","authorName","authorThumbnailSrc","agentList","name","id","thumbnail","a","b","hasAgentList","findCategoryFromSlug","slug","category","assignCategoryFromSlug","categoryFromSlug","selectedCategory","categoryList","hasCategoryMenuItems","handleArticleAction","action","actions","updateMeta","meta","saveAndSync","quickSave","saveAndSyncDebounced","quickSaveNewArticle","handleSave","articleTitle","articleContent","setAuthorId","authorId","setCategoryId","categoryId"],"mappings":"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","x_google_ignoreList":[0]}