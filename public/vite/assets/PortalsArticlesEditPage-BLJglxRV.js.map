{"version":3,"file":"PortalsArticlesEditPage-BLJglxRV.js","sources":["../../../app/javascript/dashboard/routes/dashboard/helpcenter/pages/PortalsArticlesEditPage.vue"],"sourcesContent":["<script setup>\r\nimport { ref, computed, onMounted } from 'vue';\r\nimport { useRoute, useRouter } from 'vue-router';\r\nimport { useI18n } from 'vue-i18n';\r\nimport { useAlert, useTrack } from 'dashboard/composables';\r\nimport { PORTALS_EVENTS } from 'dashboard/helper/AnalyticsHelper/events';\r\nimport { buildPortalArticleURL } from 'dashboard/helper/portalHelper';\r\nimport { useStore, useMapGetter } from 'dashboard/composables/store';\r\n\r\nimport ArticleEditor from 'dashboard/components-next/HelpCenter/Pages/ArticleEditorPage/ArticleEditor.vue';\r\n\r\nconst route = useRoute();\r\nconst router = useRouter();\r\nconst store = useStore();\r\nconst { t } = useI18n();\r\n\r\nconst { articleSlug, portalSlug } = route.params;\r\n\r\nconst articleById = useMapGetter('articles/articleById');\r\n\r\nconst article = computed(() => articleById.value(articleSlug));\r\n\r\nconst portalBySlug = useMapGetter('portals/portalBySlug');\r\n\r\nconst portal = computed(() => portalBySlug.value(portalSlug));\r\n\r\nconst isUpdating = ref(false);\r\nconst isSaved = ref(false);\r\n\r\nconst articleLink = computed(() => {\r\n  const { slug: categorySlug, locale: categoryLocale } = article.value.category;\r\n  const { slug: articleSlugValue } = article.value;\r\n  const portalCustomDomain = portal.value?.custom_domain;\r\n  return buildPortalArticleURL(\r\n    portalSlug,\r\n    categorySlug,\r\n    categoryLocale,\r\n    articleSlugValue,\r\n    portalCustomDomain\r\n  );\r\n});\r\n\r\nconst saveArticle = async ({ ...values }, isAsync = false) => {\r\n  const actionToDispatch = isAsync ? 'articles/updateAsync' : 'articles/update';\r\n  isUpdating.value = true;\r\n  try {\r\n    await store.dispatch(actionToDispatch, {\r\n      portalSlug,\r\n      articleId: articleSlug,\r\n      ...values,\r\n    });\r\n    isSaved.value = true;\r\n  } catch (error) {\r\n    const errorMessage =\r\n      error?.message || t('HELP_CENTER.EDIT_ARTICLE_PAGE.API.ERROR');\r\n    useAlert(errorMessage);\r\n  } finally {\r\n    setTimeout(() => {\r\n      isUpdating.value = false;\r\n      isSaved.value = true;\r\n    }, 1500);\r\n  }\r\n};\r\n\r\nconst saveArticleAsync = async ({ ...values }) => {\r\n  saveArticle({ ...values }, true);\r\n};\r\n\r\nconst isCategoryArticles = computed(() => {\r\n  return (\r\n    route.name === 'portals_categories_articles_index' ||\r\n    route.name === 'portals_categories_articles_edit' ||\r\n    route.name === 'portals_categories_index'\r\n  );\r\n});\r\n\r\nconst goBackToArticles = () => {\r\n  const { tab, categorySlug, locale } = route.params;\r\n  if (isCategoryArticles.value) {\r\n    router.push({\r\n      name: 'portals_categories_articles_index',\r\n      params: { categorySlug, locale },\r\n    });\r\n  } else {\r\n    router.push({\r\n      name: 'portals_articles_index',\r\n      params: { tab, categorySlug, locale },\r\n    });\r\n  }\r\n};\r\n\r\nconst fetchArticleDetails = () => {\r\n  store.dispatch('articles/show', {\r\n    id: articleSlug,\r\n    portalSlug,\r\n  });\r\n};\r\n\r\nconst previewArticle = () => {\r\n  window.open(articleLink.value, '_blank');\r\n  useTrack(PORTALS_EVENTS.PREVIEW_ARTICLE, {\r\n    status: article.value?.status,\r\n  });\r\n};\r\n\r\nonMounted(fetchArticleDetails);\r\n</script>\r\n\r\n<template>\r\n  <ArticleEditor\r\n    :article=\"article\"\r\n    :is-updating=\"isUpdating\"\r\n    :is-saved=\"isSaved\"\r\n    @save-article=\"saveArticle\"\r\n    @save-article-async=\"saveArticleAsync\"\r\n    @preview-article=\"previewArticle\"\r\n    @go-back=\"goBackToArticles\"\r\n  />\r\n</template>\r\n"],"names":["route","useRoute","router","useRouter","store","useStore","t","useI18n","articleSlug","portalSlug","articleById","useMapGetter","article","computed","portalBySlug","portal","isUpdating","ref","isSaved","articleLink","categorySlug","categoryLocale","articleSlugValue","portalCustomDomain","_a","buildPortalArticleURL","saveArticle","values","isAsync","actionToDispatch","error","errorMessage","useAlert","saveArticleAsync","isCategoryArticles","goBackToArticles","tab","locale","fetchArticleDetails","previewArticle","useTrack","PORTALS_EVENTS","onMounted"],"mappings":"0gCAWA,MAAMA,EAAQC,EAAQ,EAChBC,EAASC,EAAS,EAClBC,EAAQC,EAAQ,EAChB,CAAE,EAAAC,CAAC,EAAKC,IAER,CAAE,YAAAC,EAAa,WAAAC,GAAeT,EAAM,OAEpCU,EAAcC,EAAa,sBAAsB,EAEjDC,EAAUC,EAAS,IAAMH,EAAY,MAAMF,CAAW,CAAC,EAEvDM,EAAeH,EAAa,sBAAsB,EAElDI,EAASF,EAAS,IAAMC,EAAa,MAAML,CAAU,CAAC,EAEtDO,EAAaC,EAAI,EAAK,EACtBC,EAAUD,EAAI,EAAK,EAEnBE,EAAcN,EAAS,IAAM,OACjC,KAAM,CAAE,KAAMO,EAAc,OAAQC,CAAc,EAAKT,EAAQ,MAAM,SAC/D,CAAE,KAAMU,GAAqBV,EAAQ,MACrCW,GAAqBC,EAAAT,EAAO,QAAP,YAAAS,EAAc,cACzC,OAAOC,EACLhB,EACAW,EACAC,EACAC,EACAC,CACJ,CACA,CAAC,EAEKG,EAAc,MAAO,CAAE,GAAGC,CAAM,EAAIC,EAAU,KAAU,CAC5D,MAAMC,EAAmBD,EAAU,uBAAyB,kBAC5DZ,EAAW,MAAQ,GACnB,GAAI,CACF,MAAMZ,EAAM,SAASyB,EAAkB,CACrC,WAAApB,EACA,UAAWD,EACX,GAAGmB,CACT,CAAK,EACDT,EAAQ,MAAQ,EACjB,OAAQY,EAAO,CACd,MAAMC,GACJD,GAAA,YAAAA,EAAO,UAAWxB,EAAE,yCAAyC,EAC/D0B,EAASD,CAAY,CACzB,QAAY,CACR,WAAW,IAAM,CACff,EAAW,MAAQ,GACnBE,EAAQ,MAAQ,EACjB,EAAE,IAAI,CACR,CACH,EAEMe,EAAmB,MAAO,CAAE,GAAGN,KAAa,CAChDD,EAAY,CAAE,GAAGC,CAAQ,EAAE,EAAI,CACjC,EAEMO,EAAqBrB,EAAS,IAEhCb,EAAM,OAAS,qCACfA,EAAM,OAAS,oCACfA,EAAM,OAAS,0BAElB,EAEKmC,EAAmB,IAAM,CAC7B,KAAM,CAAE,IAAAC,EAAK,aAAAhB,EAAc,OAAAiB,CAAM,EAAKrC,EAAM,OACxCkC,EAAmB,MACrBhC,EAAO,KAAK,CACV,KAAM,oCACN,OAAQ,CAAE,aAAAkB,EAAc,OAAAiB,CAAQ,CACtC,CAAK,EAEDnC,EAAO,KAAK,CACV,KAAM,yBACN,OAAQ,CAAE,IAAAkC,EAAK,aAAAhB,EAAc,OAAAiB,CAAQ,CAC3C,CAAK,CAEL,EAEMC,EAAsB,IAAM,CAChClC,EAAM,SAAS,gBAAiB,CAC9B,GAAII,EACJ,WAAAC,CACJ,CAAG,CACH,EAEM8B,EAAiB,IAAM,OAC3B,OAAO,KAAKpB,EAAY,MAAO,QAAQ,EACvCqB,EAASC,EAAe,gBAAiB,CACvC,QAAQjB,EAAAZ,EAAQ,QAAR,YAAAY,EAAe,MAC3B,CAAG,CACH,EAEA,OAAAkB,EAAUJ,CAAmB"}